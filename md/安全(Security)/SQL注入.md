

SQL 语句的编译分为如下几个阶段：
* 基本解析：包括SQL语句的语法、语义解析，以及对应的表和列是否存在等等。
* 编译：将 SQL 语句编译成机器理解客理解的中间代码格式。
* 查询优化：编译器在所有的执行方案中选择一个最优的。
* 缓存：缓存优化后的执行方案。
*执行阶段：执行最终查询方案并返回给用户数据。

​预编译语句指的是在缓存之后，在执行阶段的之前的编译后的语句，通过**占位符**来替代查询查询参数。同样的SQL，如果参数不同普通的SQL语句每次请求都会进行编译，而预编译语句**只会编译一次**，在执行阶段会从缓存中取出预编译语句并将占位符替换成查询参数数据，而在这个阶段SQL 语句已经是编译后的语句，参数数据只能作为**纯数据**使用，不能作为SQL语句的一部分，通过SQL字符串的拼装已经不起作用，所以可以避免SQL注入。  



​如果不可避免地使用 SQL 语句进行拼装（虽然极度不推荐），可以对用户输入数据进行转移，尤其是多单双引号的转义  
 ESAPI （OWASP Enterprise Security API）